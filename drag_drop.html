<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        width: 100%;
        height: 100%;
      }
      :root {
        --items-gap: 20px;
        --bd-radius: 10px;
      }

      #container {
        width: calc(100% - 286px);
        height: 100vh;
        min-height: 440px;
        background: #eee;
        padding: 20px 30px;
        /* padding-top: 20px; */
        margin-left: auto;
        display: flex;
        flex-direction: column;
      }
      .column {
        width: 100%;
        display: flex;
        gap: var(--items-gap);
        border-radius: var(--bd-radius);
      }
      .column:not(:first-of-type) {
        margin-top: var(--items-gap);
      }
      .column[data-has-itemBool="true"] {
        flex: 1;
        background-color: transparent;
      }
      .column[data-has-itemBool="false"] {
        flex: none;
        background-color: #ffeb60;
      }
      .dragger {
        background: #fff;
        border-radius: var(--bd-radius);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        flex: 1;
      }
      .blue-background-class {
        opacity: 0.3;
      }

      #myLineChart {
        width: 100% !important;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div id="container">
      <!-- <div class="column" data-has-itemBool="false"></div> -->
      <div class="column" data-has-itemBool="true">
        <div class="dragger list-group-item" draggable="true">
          <canvas id="myLineChart"></canvas>
        </div>
        <div class="dragger list-group-item" draggable="true">list2</div>
      </div>
      <div class="column" data-has-itemBool="true">
        <div class="dragger list-group-item" draggable="true">list3</div>
        <div class="dragger list-group-item" draggable="true">list4</div>
        <div class="dragger list-group-item" draggable="true">list5</div>
      </div>
    </div>

    <script>
      const container = document.getElementById("container");
      let columns = document.querySelectorAll(".column");
      const items = container.querySelectorAll(".dragger");

      columns.forEach((column) => {
        new Sortable(column, {
          group: "shared", // 여러 column을 하나의 그룹으로 묶음
          animation: 150, // 애니메이션 속도
          ghostClass: "blue-background-class", // 움직이는 요소에게 클래스를 주어 스타일 변경 가능
          filter: ".no-drag", // 드래그를 차단할 조건
          preventOnFilter: true, // filter 조건에 맞는 요소는 드래그 차단

          onEnd: (evt) => {
            console.log(evt);
            let currentColumn = evt.from; // 이벤트 일어난 column
            const current_items = currentColumn.querySelectorAll(".dragger"); // 이벤트 일어난 column의 dragger만 선택

            if (current_items.length < 2) {
              // 아이템이 1개인 경우, 드래그를 차단하기 위해 클래스 추가
              for (cr_item of current_items) {
                cr_item.classList.add("no-drag");
              }
            } else if (current_items.length > current_items.length - 1) {
              for (all_item of items) {
                all_item.classList.remove("no-drag");
              } // 드래그 차단 해제
            }

            transHeight(); // 드래그 끝난 후에 높이 재조정
          },
          onUpdate: () => {
            transHeight(); // 항목 순서가 바뀌었을 때 높이 재조정
          },
        });

        // 전체 column의 높이를 재조정하는 함수
        function transHeight() {
          columns.forEach((column) => {
            const items = column.querySelectorAll(".dragger");
            if (items.length === 0) {
              column.setAttribute("data-has-itemBool", "false");
            } else {
              column.setAttribute("data-has-itemBool", "true");
            }
          });
        }
      });
    </script>

    <script>
      // 데이터 준비
      const data = {
        labels: ["January", "February", "March", "April", "May", "June"], // X축 값
        datasets: [
          {
            label: "Sales Over Time", //데이터 세트가 무엇을 의미하는지
            data: [25, 50, 3, 5, 20, 3], // Y축 값
            borderColor: "rgba(75, 192, 192, 1)", // 선 색상
            backgroundColor: "rgba(255, 99, 132, 0.2)",
            fill: true, // 선 아래 영역을 채울지 여부
            tension: 0.1, // 선의 곡률 조정
          },
        ], //datasets
      }; // data

      // 그래프 설정
      const config = {
        type: "bar", // 그래프 유형 line, bar, pie, doughnut, radar, scatter, bubble, mixed
        data: data,
        options: {
          scales: {
            x: {
              position: "bottom", // X축을 하단에 배치
              grid: {
                // 격자선 설정
                display: true, // 격자선 표시 여부
                color: "rgba(0, 0, 0, 0.1)", // 격자선 색상
                lineWidth: 1, // 격자선 두께
              },
            },
            y: {
              position: "left", // Y축을 왼쪽에 배치
              beginAtZero: true, // Y축이 0부터 시작
              min: 0, // Y축의 최소값을 0으로 설정
              max: 100, // Y축의 최대값을 100으로 설정
              ticks: {
                // 축의 눈금 설정정
                stepSize: 10, // 눈금 간격을 10으로 설정
                font: {
                  size: 14, // 글꼴 크기 설정
                  family: "Arial", // 글꼴 패밀리 설정
                },
                color: "rgba(75, 192, 192, 1)", // 눈금 글꼴 색상
              },
            },
            y2: {
              type: "linear", // 선형 Y축
              position: "right", // 오른쪽 Y축
              beginAtZero: true,
              grid: {
                drawOnChartArea: false, // 오른쪽 Y축에는 격자선 표시 안 함
              },
            },
          }, // scales

          responsive: true, // 화면 크기 변경 시 차트 크기 자동 조정

          maintainAspectRatio: false, // 비율을 유지하지 않음

          animation: {
            duration: 1000, // 애니메이션 지속 시간
          }, // animation

          plugins: {
            legend: {
              position: "bottom", // 범례(데이터 설명) 위치 top, right, bottom, left
              labels: {
                font: {
                  size: 14, // 글꼴 크기
                  weight: "bold", // 글꼴 두께
                  family: "Arial", // 글꼴 패밀리
                }, //font
                color: "rgba(0, 0, 0, 0.7)", // 글꼴 색상
              }, //labels
            }, //legend

            title: {
              // 차트의 제목 (차트가 무엇을 나타내는지, 차트 상단에 표시)
              display: true,
              text: "Sales Over Time",
              font: {
                size: 18, // 글꼴 크기
                weight: "bold", // 글꼴 두께
                family: "Arial", // 글꼴 패밀리
              }, //font
              color: "rgba(0, 0, 0, 0.8)", // 글꼴 색상
              padding: {
                top: 20, // 제목 위 여백
                bottom: 20, // 제목 아래 여백
              }, //padding
            }, //title
          }, //plugins
        }, //options
      }; // config

      // 그래프 그리기
      const ctx = document.getElementById("myLineChart").getContext("2d");
      const myLineChart = new Chart(ctx, config);
    </script>
  </body>
</html>
